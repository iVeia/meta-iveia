/*
 * Machine specific FSBL hooks
 *
 * (C) Copyright 2020, iVeia
 */
#include <xil_io.h>
#include "psu_init.h"

#define CRL_APB_RST_LPD_IOU2_OFFSET 0xFF5E0238 
void iv_z8_init_before_hook() 
{
//WRITES FROM PSU_MIO_INIT_DATA
    PSU_Mask_Write(IOU_SLCR_MIO_MST_TRI1_OFFSET,0x00000030, 0x00000000);
    Xil_Out32(IOU_SLCR_MIO_PIN_36_OFFSET, 0x00000040);
    Xil_Out32(IOU_SLCR_MIO_PIN_37_OFFSET, 0x00000040);

//WRITES FROM PSU_CLOCK_INIT_DATA
    PSU_Mask_Write(CRL_APB_I2C0_REF_CTRL_OFFSET,0x013F3F07U, 0x01010F00U);
    PSU_Mask_Write(CRL_APB_I2C1_REF_CTRL_OFFSET,0x013F3F07U, 0x01010F00U);
    PSU_Mask_Write(CRL_APB_TIMESTAMP_REF_CTRL_OFFSET,0x01003F07U, 0x01000104U);

//////////
    PSU_Mask_Write(CRL_APB_RST_LPD_IOU2_OFFSET,0x00100000,0x00000000);
    PSU_Mask_Write(CRL_APB_RST_LPD_IOU2_OFFSET,0x00000060,0x00000000);
    PSU_Mask_Write(CRL_APB_RST_LPD_IOU2_OFFSET,0x00000600,0x00000000);
}

